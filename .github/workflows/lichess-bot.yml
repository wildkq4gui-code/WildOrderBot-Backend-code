name: Lichess Bot Scheduled Run

# Runs daily at 13:00 UTC (which is 07:00 CST when CST = UTC-6).
# GitHub Actions cron schedules use UTC. If your target timezone observes DST
# (e.g., switches to CDT = UTC-5), adjust the cron accordingly or add two
# schedules (one for standard time, one for daylight time).

on:
  schedule:
    - cron: '0 13 * * *'  # 13:00 UTC daily -> 07:00 CST (UTC-6)
  workflow_dispatch: {}

jobs:
  run:
    runs-on: ubuntu-latest
    env:
      LICHESS_TOKEN: ${{ secrets.LICHESS_TOKEN }}

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: Install dependencies (best-effort)
        run: |
          python -m pip install --upgrade pip setuptools wheel
          if [ -f "requirements.txt" ]; then pip install -r requirements.txt; fi
          if [ -f "LichessStockfishand-fairy-fish-1/pyproject.toml" ]; then pip install -e LichessStockfishand-fairy-fish-1 || true; fi

      - name: Run scheduled bot
        # The script expects `LICHESS_TOKEN` in the environment (set above from repo secret).
        run: |
          # Ensure the built stockfish binary is executable
          chmod +x LichessStockfishand-fairy-fish-1/stockfish/stockfish-ubuntu-x86-64-avx2 || true
          chmod +x LichessStockfishand-fairy-fish-1/stockfish/fairy-stockfish || true
          python3 LichessStockfishand-fairy-fish-1/run_scheduled.py
